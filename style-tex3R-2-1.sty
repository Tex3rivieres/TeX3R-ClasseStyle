\NeedsTeXFormat{LaTeX2e}[2022-11-01]
\ProvidesPackage{style-tex3R-2-1}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%% FORMAT DE LA PAGE %%%
%%%%%%%%%%%%%%%%%%%%%%%%%

%#1 = couleur ; #2 = type de section
\newcommand{\stylesections}[3]{\colorbox{#1}{\textcolor{white}{\normalfont#2\textbf{{#3}}}}}

\begin{luacode}
  function FormatUtilisateur (PARAMETRES)

    local FORMAT = PARAMETRES.format
    local HEADER = PARAMETRES.header

    local PAGE = {}
    local DOC = {}
    local DOC_HEADER = {}

    PAGE.enumi = '\\textbf{\\arabic*. }'
    PAGE.enumii = '\\textbf{\\alph*. }'
    PAGE.itemi = '\\textbullet'
    PAGE.itemii = '$\\circ$'

    PAGE.sectionname = '\\LARGE\\bfseries\\textcolor{couleursection}'
    PAGE.subsectionname = '\\Large\\bfseries\\textcolor{couleursubsection}'
    PAGE.subsubsectionname = '\\normalfont\\large\\bfseries\\textcolor{couleursubsubsection}'

    PAGE.sectionnumber = '\\stylesections{couleursection}{\\LARGE}{~\\Roman{section}~}\\,'
    PAGE.subsectionnumber = '\\stylesections{couleursubsection}{\\LARGE}{\\Alph{subsection}}\\,'
    PAGE.subsubsectionnumber = '\\stylesections{couleursubsubsection}{\\LARGE}{\\arabic{subsubsection}}\\,'

    PAGE.sectionsformat = '#3 \\ul{#4}\\par\\vspace{0.5em}'
    PAGE.partformat = ''

    if FORMAT == "fiche" then
      PAGE.width = '21cm'
      PAGE.height = '29.7cm'
      PAGE.parindent = '0pt'
      PAGE.parskip = '0pt'
      --Marges du format 'fiche' sans header
      DOC.top = '1cm'
      DOC.bottom = '1cm'
      DOC.right = '1cm'
      DOC.left = '1cm'
      DOC.marginparsep = '0cm'
      DOC.marginparwidth = '0cm'
      DOC.headheight = '0cm'
      DOC.headsep = '0cm'
      DOC.footskip = '0cm'
      --Marges du format 'fiche' avec header
      DOC_HEADER.top = '1cm'
      DOC_HEADER.bottom = '1cm'
      DOC_HEADER.right = '1cm'
      DOC_HEADER.left = '1cm'
      DOC_HEADER.marginparsep = '0cm'
      DOC_HEADER.marginparwidth = '0cm'
      DOC_HEADER.headheight = '1cm'
      DOC_HEADER.headsep = '0.5cm'
      DOC_HEADER.footskip = '0cm'
    elseif FORMAT == "diapo" then
      PAGE.width = '28.8cm'
      PAGE.height = '18cm'
      PAGE.parindent = '0pt'
      PAGE.parskip = '0pt'
      --Marges du format 'diapo' sans header
      DOC.top = '0.5cm'
      DOC.bottom = '3cm'
      DOC.right = '1cm'
      DOC.left = '1cm'
      DOC.marginparsep = '0cm'
      DOC.marginparwidth = '0cm'
      DOC.headheight = '0cm'
      DOC.headsep = '0cm'
      DOC.footskip = '0cm'
      --Marges du format 'diapo' avec header
      DOC_HEADER.top = '0.5cm'
      DOC_HEADER.bottom = '3cm'
      DOC_HEADER.right = '1cm'
      DOC_HEADER.left = '1cm'
      DOC_HEADER.marginparsep = '0cm'
      DOC_HEADER.marginparwidth = '0cm'
      DOC_HEADER.headheight = '2.5cm'
      DOC_HEADER.headsep = '0.5cm'
      DOC_HEADER.footskip = '0cm'
    end
    return PAGE,DOC,DOC_HEADER
  end
\end{luacode}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%% FORMATAGES DIVERS %%%
%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{luacode}
  function PoliceUtilisateur()

    local POLICE = {}

    POLICE.taillefiche = '12pt'
    POLICE.taillediapo = '20pt'
    POLICE.texte = 'Calibri'
    POLICE.math = 'STIX Two Math'
    POLICE.mathcal = 'Libertinus Math Regular'

    return POLICE
  end
\end{luacode}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% DÉFINITION DES COULEURS %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{luacode}
  function CouleursUtilisateur(PARAMETRES)
    local PRINT = PARAMETRES.print
    local COULEURS = {}

    if PRINT then
      COULEURS.ligne = 'black'
      COULEURS.interligne = 'black!30'
      COULEURS.section = 'black'
      COULEURS.subsection = 'black!70'
      COULEURS.subsubsection = 'black!40'
    else
      COULEURS.ligne = 'SlateBlue'
      COULEURS.interligne = 'LightSteelBlue'
      COULEURS.section = 'black'
      COULEURS.subsection = 'Red'
      COULEURS.subsubsection = 'Green'
    end
    return COULEURS
  end 
\end{luacode}

%%%%%%%%%%%%%%%%%%%%%%%
%%% CHOIX DES LOGOS %%%
%%%%%%%%%%%%%%%%%%%%%%%

\begin{luacode}
  function LogosUtilisateur()

    local LOGOS = {}

    LOGOS.activite = '\\reflectbox{\\faPencil*}'
    LOGOS.basique = ''
    LOGOS.bilan = '\\faEdit[regular]'
    LOGOS.corrige = '\\faEdit[regular]'
    LOGOS.cours = '\\faBook'
    LOGOS.DM = '\\faHome'
    LOGOS.DS = '\\faFile*[regular]'
    LOGOS.flash = '\\faUserSecret'
    LOGOS.interro = '\\faFile*[regular]'
    LOGOS.TD = '\\faEdit[regular]'

    return LOGOS
  end
\end{luacode}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% REDÉFINITION DES TITRES %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{luacode}
  function StylesTitresUtilisateur(PARAMETRES)

    local STYLESTITRES = {}
    local FORMAT = PARAMETRES.format

    STYLESTITRES.titre = '{\\bfseries\\LARGE\\logoactif~ \\underLine{#1}\\par\\vspace{0.5cm}}'
    STYLESTITRES['sans'] = '\\titre{#1}'
    STYLESTITRES['un'] = '\\titre{#1\\hfill\\mdseries\\large\\rivniveau$^\\text{ème}$}'
    STYLESTITRES['deux'] = '\\titre{#1~\\mdseries|~\\rivchapitre\\hfill\\large\\rivniveau$^\\text{ème}$}'
    STYLESTITRES['trois'] = '\\titre{#1~\\mdseries|~{\\large\\mdseries NOM :} \\hfill {\\large\\mdseries Prénom :} \\hfill \\mdseries\\large\\rivniveau$^\\text{ème}$}'

    if FORMAT == "fiche" then    

    STYLESTITRES.activite = STYLESTITRES['un']
    STYLESTITRES.basique = STYLESTITRES['sans']
    STYLESTITRES.bilan = STYLESTITRES['un']
    STYLESTITRES.corrige = STYLESTITRES['deux']
    STYLESTITRES.cours = STYLESTITRES['deux']
    STYLESTITRES.DM = STYLESTITRES['trois']
    STYLESTITRES.DS = STYLESTITRES['trois']
    STYLESTITRES.flash = STYLESTITRES['un']
    STYLESTITRES.interro = STYLESTITRES['trois']
    STYLESTITRES.TD = STYLESTITRES['deux']

    elseif FORMAT == "diapo" then

    STYLESTITRES.activite = STYLESTITRES['un']
    STYLESTITRES.basique = STYLESTITRES['sans']
    STYLESTITRES.bilan = STYLESTITRES['un']
    STYLESTITRES.corrige = STYLESTITRES['deux']
    STYLESTITRES.cours = STYLESTITRES['deux']
    STYLESTITRES.DM = STYLESTITRES['trois']
    STYLESTITRES.DS = STYLESTITRES['trois']
    STYLESTITRES.flash = STYLESTITRES['un']
    STYLESTITRES.interro = STYLESTITRES['trois']
    STYLESTITRES.TD = STYLESTITRES['deux']

    end

    return STYLESTITRES
  end

  function TitresUtilisateur(PARAMETRES)

    local FORMAT = PARAMETRES.format
    local TYPE = PARAMETRES.type
    local TITRE = nil

    if TYPE == 'activite' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{Activité}}'
    elseif TYPE == 'basique' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{}}'
    elseif TYPE == 'bilan' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{Bilan}}'
    elseif TYPE == 'corrige' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{Corrigé}}'
    elseif TYPE == 'cours' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{Chapitre \\thepart}}'
    elseif TYPE == 'DM' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{DM n°\\stepcounter{compteurDM}\\thecompteurDM}}'
    elseif TYPE == 'DS' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{DS n°\\stepcounter{compteurDS}\\thecompteurDS}}'
    elseif TYPE == 'flash' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{Questions Flash n°\\stepcounter{compteurflash}\\thecompteurflash}}'
    elseif TYPE == 'interro' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{Interrogation n°\\stepcounter{compteurinterro}\\thecompteurinterro}}'
    elseif TYPE == 'TD' then
      TITRE = '\\renewcommand{\\titreactif}{\\styleactif{TD}}'
    end
    tex.sprint(TITRE)

  end
\end{luacode}